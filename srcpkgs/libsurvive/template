# Template file for 'libsurvive'
pkgname=libsurvive
version=1.0
revision=1
_cnkalman_commit=630e034ba13305b01d5ab7f38db141db9cd72f41
_cnmatrix_commit=ce07c5993a32149bf6685951d2fd3619f363ec02
build_wrksrc="libsurvive-${version}"
build_style=cmake
configure_args="-DENABLE_TESTS=ON"
hostmakedepends="git"
makedepends="zlib-devel libX11-devel libusb-devel libfreeglut-devel
 lapacke-devel openblas-devel eigen cblas-devel libpcap-devel"
short_desc="Open Source VR Lighthouse Tracking System"
maintainer="Adam Gausmann <adam@gaussian.dev>"
license="MIT"
homepage="https://github.com/cntools/libsurvive"
changelog="https://github.com/cntools/libsurvive/releases"
distfiles="https://github.com/cntools/libsurvive/archive/v${version}.tar.gz
 https://github.com/cntools/cnkalman/archive/${_cnkalman_commit}.tar.gz
 https://github.com/cntools/cnmatrix/archive/${_cnmatrix_commit}.tar.gz"
checksum="a16d7bc0825d5f1986dd7b9c6edbe2963d391dfc53a415e6ca6dbe88dcc58e0e
 3578d2edca87af70afbb51d64dafee98ecc3fb2ca16b2ee129e6cc907a47ef16
 07d55b7aaef87eacd5e37c61c475fc309477639fdcf5926c1adb1439794244c1"

post_extract() {
	rmdir "${build_wrksrc}/libs/cnkalman"
	mv "cnkalman-${_cnkalman_commit}" "${build_wrksrc}/libs/cnkalman"
	rmdir "${build_wrksrc}/libs/cnkalman/libs/cnmatrix"
	mv "cnmatrix-${_cnmatrix_commit}" "${build_wrksrc}/libs/cnkalman/libs/cnmatrix"
}

post_install() {
	vlicense LICENSE
	vlicense libs/cnkalman/LICENSE cnkalman.LICENSE
	vlicense libs/cnkalman/libs/cnmatrix/LICENSE cnmatrix.LICENSE
}

libsurvive-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
	}
}
